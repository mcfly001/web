<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title></title>
    <script src='../js/default.js'></script>
</head>

<body>
    <div class="wrapper">
        <div class="main">
            <div class="choose_area">
                <ol class="ol_tag clear">
                    <li><a data-key="access_control" href="#" class="selected">访问控制</a></li>
                </ol>
            </div>
            <div class="field-wrap" align="center">
                <table cellpadding="0" cellspacing="0" border="0">
                    <tr>
                        <td valign="top">
                            <fieldset>
                                <legend><b data-key="access_control">访问控制</b></legend>
                                <div class="vertiplace">
                                    <div class="line">
                                        <div data-key="web_access_control" class="row-rlabel">Web访问控制</div>
                                        <div class="row-input">
                                            <input type="checkbox" name="web_control" id="web_switch"><span><em data-key="allow_access_web">允许通过外网访问Web管理界面</em></span></div>
                                    </div>
                                    <div class="line">
                                        <div data-key="ssh_channel_controller" class="row-rlabel">ssh通道控制</div>
                                        <div class="row-input">
                                            <input type="checkbox" name="ssh_control" id="ssh_switch"><span><em data-key="enable_ssh_channel">开启ssh通道</em></span></div>
                                    </div>
                                    <div class="line-submit rightspan clear">
                                        <div>
                                            <button data-key="modify" id="Tchange">修改</button>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</body>
<script>
var web_switch = true;
var ssh_switch = true;

(function() {
    $.ajax({
        url: '../../cgi-bin/common.cgi?luaname=system_accessctrl&action=read',
        type: "GET",
        contentType: "application/json",
        dataType: 'json',
        success: function(data) {
            console.log(data);
            console.log(data.result.enable_web);
            console.log(data.result.enable_ssh);
            if (data.result.code == 0) {
                var enable_web = data.result.enable_web;
                if (enable_web == "true") {
                    $("#web_switch").prop("checked", true)
                    web_switch = true;
                } else if (enable_web == "false") {
                    $("#web_switch").prop("checked", false)
                    web_switch = false;
                }

                var enable_ssh = data.result.enable_ssh;
                if (enable_ssh == "true") {
                    $("#ssh_switch").prop("checked", true)
                    ssh_switch = true;
                } else if (enable_ssh == "false") {
                    $("#ssh_switch").prop("checked", false)
                    ssh_switch = false;
                }

            } else {
                console.log("code is not 0")
            }
        },
        error: function() {
            console.log("no data");
        }

    })
})();


$("#Tchange").click(function() {
    var web_switch_new = $("#web_switch").prop("checked");
    var ssh_switch_new = $("#ssh_switch").prop("checked");
    console.log(web_switch, web_switch_new, ssh_switch, ssh_switch_new)
    if ((web_switch_new === web_switch) && (ssh_switch_new === ssh_switch)) {
        lang_alert('contrl_switch_no_change')
    } else {
        var url = url_host + 'system_accessctrl&action=modify&enable_web=' + web_switch_new + '&enable_ssh=' + ssh_switch_new + url_time;
        check_code0(url);

    }

})
</script>

</html>
